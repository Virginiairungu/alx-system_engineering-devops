#!/usr/bin/env bash

# Update and install nginx if not installed
sudo apt update
sudo apt install nginx -y

# Ensure the nginx default configuration is set to listen on port 80
sudo sed -i 's/listen 80 default_server;/listen 80 default_server;/' /etc/nginx/sites-available/default
sudo sed -i 's/listen \[::\]:80 default_server;/listen \[::\]:80 default_server;/' /etc/nginx/sites-available/default

# Start nginx to apply changes
sudo systemctl start nginx

# Enable nginx to start on boot
sudo systemctl enable nginx

# Allow Nginx HTTP through the firewall
sudo ufw allow 'Nginx HTTP'
sudo ufw reload

# Check the status of nginx
nginx_status=$(sudo systemctl is-active nginx)

if [ "$nginx_status" == "active" ]; then
    echo "Nginx is running and listening on port 80"
else
    echo "Failed to start Nginx. Checking logs..."
    sudo journalctl -xe
    sudo tail -f /var/log/nginx/error.log
fi
